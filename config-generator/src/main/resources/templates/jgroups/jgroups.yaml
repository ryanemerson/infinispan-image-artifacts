  # TODO update to use camelCase
  jgroups:
    stacks:
      - stack:
          name: image-tcp
          extends: tcp
          TCP:
            bind_addr: $\{jgroups.bind.address,jgroups.tcp.address:{jgroups.bindAddress}\}
            bind_port: $\{jgroups.bind.port,jgroups.tcp.port:7800\}
            enable_diagnostics: {jgroups.diagnostics}
          {#if jgroups.dnsPing.query}
          dns.DNS_PING:
            dns_address: {jgroups.dnsPing.address}
            dns_query: {jgroups.dnsPing.query}
            dns_record_type: {jgroups.dnsPing.recordType}
            stack.combine: REPLACE
            stack.position: MPING
          {#else}
          MPING:
            bind_addr: $\{jgroups.bind.address,jgroups.tcp.address:{jgroups.bindAddress}\}
          {/if}
          # TODO JGROUPS encryption. Is this automatic now with Tristan's changes?
          {#include jgroups/encrypt /}
      - stack:
          name: image-udp
          extends: udp
          UDP:
            enable_diagnostics: {jgroups.diagnostics}
            port_range: 0
          {#if jgroups.dnsPing.query}
            dns.DNS_PING:
              dns_address: {jgroups.dnsPing.address}
              dns_query: {jgroups.dnsPing.query}
              dns_record_type: {jgroups.dnsPing.recordType}
              stack.combine: REPLACE
              stack.position: MPING
          {#else}
          MPING:
            bind_addr: $\{jgroups.bind.address,jgroups.tcp.address:{jgroups.bindAddress}\}
          {/if}
          # TODO JGROUPS encryption. Is this automatic now with Tristan's changes?
          {#include jgroups/encrypt /}
          FD_SOCK:
            client_bind_port: 57600
            start_port: 57600
    {#if xsite.backups}
      - stack:
          name: xsite
          extends: image-{jgroups.transport}
          relay.RELAY2:
            site: {xsite.name}
            max_site_masters: {xsite.maxSiteMasters}
            can_become_site_master: {xsite.masterCandidate}
          remoteSites:
            defaultStack: relay-global
            # TODO update once fixed in server
            {#each xsite.backups}
            remoteSite:
              name: {it.name}
            {/each}

    stackFiles:
      - name: relay-global
        path: jgroups-relay.xml

    {/if}
